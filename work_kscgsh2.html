<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/mui.css" rel="stylesheet" />
		<style>
			.mui-btn-block {
				padding: 10px 0;
			}
			
			.bT {
				margin-bottom: -10px;
			}
			
			#dcontent ul li {
				line-height: 35px;
			}
			
			.mui-plus .plus {
				display: inline;
			}
			
			.plus {
				display: none;
			}
			
			#topPopover {
				position: fixed;
				top: 16px;
				right: 6px;
			}
			
			#topPopover .mui-popover-arrow {
				left: auto;
				right: 6px;
			}
			
			p {
				text-indent: 22px;
			}
			
			span.mui-icon {
				font-size: 14px;
				color: #007aff;
				margin-left: -15px;
				padding-right: 10px;
			}
			
			.mui-popover {
				height: 100px;
			}
			
			.mui-content {
				padding: 10px;
			}
			
			.mui-table-view-cell {
				font-size: 14px;
			}
			
			.text_empty {
				font-size: 16px;
				color: #ccc;
				margin-left: 16px;
				margin-top: 16px;
			}
		</style>
	</head>

	<body>
		<div class="mui-navbar-inner mui-bar mui-bar-nav">
			<h1 class="mui-center mui-title">款式初稿审核-记录操作</h1>
			<a id="menu" class="mui-action-menu mui-icon mui-icon-bars mui-pull-right" href="#topPopover"></a>
		</div>
		<div class="mui-content">
			<div id="dcontent" class="mui-content-padded ">
				<h5>上传文件列表：</h5>
				<div id="files" style="text-align:left;">
					<p id="empty" class="text_empty">无上传文件</p>
				</div>
			</div>
			<div class="mui-content-padded bT">
				<h5>设计说明：</h5>
				<div class="mui-input-row">
					<textarea id="designremark" rows="4" disabled="disabled" style="color: #CCCCCC;"></textarea>
				</div>
			</div>
			<div class="mui-content-padded bT">
				<h5>审核说明：</h5>
				<div class="mui-input-row">
					<textarea id="cscgcheck" rows="4"></textarea>
				</div>
				<button type="button" class="mui-btn mui-btn-primary mui-btn-block mui-icon mui-icon-mic mui-center">
		           	语音输入
		        </button>
			</div>
			<div class="mui-content-padded">
				<table width='100%'>
					<tr>
						<td>
							
							<button id="submitbtn01" class="mui-btn mui-btn mui-btn-primary" type='button'  onclick="submittasksub(1);">审核通过</button>
							
						</td>
						<td>
							
								<button id="submitbtn02" class="mui-btn mui-btn mui-btn-warning" type='button'  onclick="submittasksub(2);">审核不通过</button>									
							
				
						</td>
					</tr>
				</table>
				<center>
				</center>
			</div>
			<div id="topPopover" class="mui-popover">
				<div class="mui-popover-arrow"></div>
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view">
							<li class="mui-table-view-cell">
								<a href="javascript:;" onclick="opentaskdetail();">查看研发任务详细</a>
							</li>
							<li class="mui-table-view-cell">
								<a href="#">查看款式初稿详细</a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<script src="js/mui.min.js"></script>
		<script src="js/common.js"></script>
		<script src="js/h.js"></script>
		<script type="text/javascript" charset="utf-8">
			(function($, doc) {
				$.init();
				$.plusReady(function (){
//					getDevtaskData();
//					console.log('test1:' + plus.storage.getItem('devtask'));
//					getData();
				});
				
			})(mui, document);
			
			// 查看已上传图片
			function openview(purl) {
				//console.log(purl);
				plus.storage.setItem('kscg_uploadfile', purl);
				plus.storage.setItem('delebtnisvisible', 'false');
				mui.openWindow({
					url: 'kscg_view.html',
					id: 'kscg_view',
					show: {
						autoShow: false
					}
				});
			}
			
			// 查看研发任务详细
			function opentaskdetail() {
				mui.openWindow({
					url: 'task_detail.html',
					id: 'task_detail',
					show: {
						autoShow: false
					}
				});
			}
			
			function getDevtaskData() {
				mui.post(
					url + 'devtask/getdevtaskbysubguid?token=' +
					plus.storage.getItem('token'), {
						subguid: plus.storage.getItem('currentsubinfo'),
					},
					function(data) {
						if(data.flag == "get_devtask_by_subguid_success") {
							if(plus.storage.getItem('devtask')) {
								plus.storage.removeItem('devtask');
							}
							plus.storage.setItem('devtask', JSON.stringify(data.data.devtask));
						}
					},
					'json'
				);
			}
			
			// 获取款式初稿的工作数据
			function getData() {
				plus.storage.removeItem('kscg_uploadfiles');
				mui.post(
					url + 'devtask/getcscgdata?token=' + plus.storage.getItem('token'), {
						subguid: plus.storage.getItem('currentsubinfo'),
					},
					function(data) {
						if(data.flag == 'success') {
							//console.log(data.data.uploadfiles);
							//console.log(data.data.designremark);
							h('#files').html('').html('<p id="empty" class="text_empty">无上传文件</p>');
							h('#designremark').val(data.data.designremark);

							if(data.data.uploadfiles != null && data.data.uploadfiles != '') {
								files = JSON.parse(data.data.uploadfiles);
								var fe = document.getElementById("files");

								if(files.length > 0) {
									plus.storage.setItem('kscg_uploadfiles', JSON.stringify(files));
								}

								for(var i = 0; i < files.length; i++) {
									//console.log(files[i].url);
									var li = document.createElement("li");
									var n = "";
									if(files[i].url.indexOf("_IMG_") >= 0) {
										//console.log(files[i].url.indexOf("_IMG_"));
										n = files[i].url.substr(files[i].url.indexOf('_IMG_') + 1);
									} else {
										n = files[i].url.substr(files[i].url.lastIndexOf('_') + 1);
									}
									var aa = '<a href="javascript:;" onclick="openview(\'' + files[i].url + '\')">' + n + '</a>';
									li.innerHTML = aa;
									fe.appendChild(li);
								}
								empty.style.display = "none";
							}
						}
					},
					'json'
				);
			}
		</script>
	</body>

</html>