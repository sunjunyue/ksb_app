<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/mui.css" rel="stylesheet" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav hBg">
			<div id="logo">
				<img src="imgs/logo2.jpeg" />
				<h1 class="mui-title" style="color: #FFFFFF;">款式宝</h1>
			</div>
		</header>
		<nav class="mui-bar mui-bar-tab hBg" id="navFooter">
			<a class="mui-tab-item mui-active" id="nav1">
				<span class="mui-icon mui-icon-home" style="color: #FFFFFF"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item" id="nav2">
				<span class="mui-icon mui-icon-phone" style="color: #FFFFFF"></span>
				<span class="mui-tab-label">工作</span>
			</a>
			<a class="mui-tab-item" id="nav5">
				<div style="margin:5px auto;text-align:center;">
					<img src="imgs/logo.jpeg" height="35px" />
				</div>
			</a>
			<a class="mui-tab-item" id="nav3">
				<span class="mui-icon mui-icon-chatboxes" style="color: #FFFFFF" id="message_span"></span>
				<span class="mui-tab-label">消息</span>
			</a>
			<a class="mui-tab-item" id="nav4">
				<span class="mui-icon mui-icon-settings" style="color: #FFFFFF"></span>
				<span class="mui-tab-label">设置</span>
			</a>
		</nav>
		<script src="js/mui.min.js"></script>
		<script src="js/h.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" charset="utf-8">
			mui.init({
				subpages: [{
					url: 'home.html',
					id: 'home.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%"
					}
				}, {
					url: 'work.html',
					id: 'work.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "100%"
					}
				}, {
					url: 'message.html',
					id: 'message.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "200%"
					}
				}, {
					url: 'settings2.html',
					id: 'settings2.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "300%"
					}
				}, {
					url: 'workbarcode.html',
					id: 'workbarcode.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "400%"
					}
				}, {
					url: 'message_detail.html',
					id: 'message_detail.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "500%"
					}
				}, {
					url: 'work_kscg2.html',
					id: 'work_kscg2.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "600%"
					}
				}, {
					url: 'work_kscgsh.html',
					id: 'work_kscgsh.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "600%"
					}
				}, {
					url: 'work_mflzb.html',
					id: 'work_mflzb.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "600%"
					}
				}, {
					url: 'work_mflsh.html',
					id: 'work_mflsh.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "600%"
					}
				}, {
					url: 'work_sjzb.html',
					id: 'work_sjzb.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "600%"
					}
				}, {
					url: 'work_yycj.html',
					id: 'work_yycj.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "600%"
					}
				}, {
					url: 'work_yyzz.html',
					id: 'work_yyzz.html',
					styles: {
						top: '44px',
						bottom: '50px',
						width: "100%",
						left: "600%"
					}
				}]
			});

			h('#nav1').tap(function() {
				changeSub(1);
			});
			h('#nav2').tap(function() {
				changeSub(2);
			});
			h('#nav3').tap(function() {
				changeSub(3);
			});
			h('#nav4').tap(function() {
				// 判断用户是否已经登录
				/*var uid = plus.storage.getItem('uid');
				if(!uid) {
					loginByWx('changeSub(4);');
					return false;
				}*/
				changeSub(4);
			});
			h('#nav5').tap(function() {
				changeSub(5);
			});

			function changeSub(index,flag) {
				var settings = plus.webview.getWebviewById('settings2.html'); // 4
				var message = plus.webview.getWebviewById('message.html'); // 3
				var message_detail = plus.webview.getWebviewById('message_detail.html'); // 6
				var workbarcode = plus.webview.getWebviewById('workbarcode.html'); // 5
				var home = plus.webview.getWebviewById('home.html'); // 1
				var work = plus.webview.getWebviewById('work.html'); // 2
				var kscg = plus.webview.getWebviewById('work_kscg2.html'); // 7
				var kscgsh = plus.webview.getWebviewById('work_kscgsh.html'); // 8
				var mflzb = plus.webview.getWebviewById('work_mflzb.html');  // 9
				var mflsh = plus.webview.getWebviewById('work_mflsh.html');  // 10
				var sjzb = plus.webview.getWebviewById('work_sjzb.html');  // 11
				var yycj = plus.webview.getWebviewById('work_yycj.html'); // 12
				var yyzz = plus.webview.getWebviewById('work_yyzz.html'); // 13
				if (index != 1 && index != 4) {
					if (!plus.storage.getItem('uid')){
						mui.toast('请先登录');
						index = 4;
					}
				}
				
				message.evalJS('tt(1);setOn();');
				getnewmessagecount();
				
				// 清空任务扫描页
				if (index != 5) {
					workbarcode.evalJS('resetwindow();');
				}
				if (index == 5 && flag != undefined){
					workbarcode.evalJS("al('"+flag+"');");
				}
				
				if (index == 6) {
					message_detail.evalJS('getSMSData()');
				}
				
				if (index == 2) {
					work.evalJS('getData()');
				}
				
//				if (index == 7) {
//					kscg.evalJS('getShls()');
//				}
				
				home.setStyle({
					left: (1 - index) * 100 + "%"
				});
				work.setStyle({
					left: (2 - index) * 100 + "%"
				});
				message.setStyle({
					left: (3 - index) * 100 + "%"
				});
				settings.setStyle({
					left: (4 - index) * 100 + "%"
				});
				workbarcode.setStyle({
					left: (5 - index) * 100 + "%"
				});
				message_detail.setStyle({
					left: (6 - index) * 100 + "%"
				});
				kscg.setStyle({
					left: (7 - index) * 100 + "%"
				});
				kscgsh.setStyle({
					left: (8 - index) * 100 + "%"
				});
				mflzb.setStyle({
					left: (9 - index) * 100 + "%"
				});
				mflsh.setStyle({
					left: (10 - index) * 100 + "%"
				});
				sjzb.setStyle({
					left: (11 - index) * 100 + "%"
				});
				yycj.setStyle({
					left: (12 - index) * 100 + "%"
				});
				yyzz.setStyle({
					left: (13 - index) * 100 + "%"
				});
			}
			
			function getnewmessagecount() {
				if (!plus.storage.getItem('uid')) {
					h('#message_span').html('');
					return;
				}
				mui.post(
					'http://192.168.31.243/ksbapi2/api/sm/getsmcountnew?token=' + plus.storage.getItem('token'), {
						uid: plus.storage.getItem('uid'),
					},
					function(data) {
						if(data.flag == 'get_smcount_new_success') {
							if (data.data.sms_count > 0){
								h('#message_span').html('<span id="msgbadge" style="visibility: visible;" class="mui-badge">'+data.data.sms_count+'</span>');
							} else {
								h('#message_span').html('');
							}
						}
					},
					'json'
				);
			}
			
			mui.plusReady(function () {
				getnewmessagecount();
			});
		</script>
	</body>

</html>